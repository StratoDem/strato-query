
<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <title>StratoDem Analytics API</title>
    <link href="images/favicon.ico" rel="icon" type="image/ico" />

    <style>
      .highlight table td { padding: 5px; }
.highlight table pre { margin: 0; }
.highlight .gh {
  color: #999999;
}
.highlight .sr {
  color: #f6aa11;
}
.highlight .go {
  color: #888888;
}
.highlight .gp {
  color: #555555;
}
.highlight .gs {
}
.highlight .gu {
  color: #aaaaaa;
}
.highlight .nb {
  color: #f6aa11;
}
.highlight .cm {
  color: #75715e;
}
.highlight .cp {
  color: #75715e;
}
.highlight .c1 {
  color: #75715e;
}
.highlight .cs {
  color: #75715e;
}
.highlight .c, .highlight .cd {
  color: #75715e;
}
.highlight .err {
  color: #960050;
}
.highlight .gr {
  color: #960050;
}
.highlight .gt {
  color: #960050;
}
.highlight .gd {
  color: #49483e;
}
.highlight .gi {
  color: #49483e;
}
.highlight .ge {
  color: #49483e;
}
.highlight .kc {
  color: #66d9ef;
}
.highlight .kd {
  color: #66d9ef;
}
.highlight .kr {
  color: #66d9ef;
}
.highlight .no {
  color: #66d9ef;
}
.highlight .kt {
  color: #66d9ef;
}
.highlight .mf {
  color: #ae81ff;
}
.highlight .mh {
  color: #ae81ff;
}
.highlight .il {
  color: #ae81ff;
}
.highlight .mi {
  color: #ae81ff;
}
.highlight .mo {
  color: #ae81ff;
}
.highlight .m, .highlight .mb, .highlight .mx {
  color: #ae81ff;
}
.highlight .sc {
  color: #ae81ff;
}
.highlight .se {
  color: #ae81ff;
}
.highlight .ss {
  color: #ae81ff;
}
.highlight .sd {
  color: #e6db74;
}
.highlight .s2 {
  color: #e6db74;
}
.highlight .sb {
  color: #e6db74;
}
.highlight .sh {
  color: #e6db74;
}
.highlight .si {
  color: #e6db74;
}
.highlight .sx {
  color: #e6db74;
}
.highlight .s1 {
  color: #e6db74;
}
.highlight .s {
  color: #e6db74;
}
.highlight .na {
  color: #a6e22e;
}
.highlight .nc {
  color: #a6e22e;
}
.highlight .nd {
  color: #a6e22e;
}
.highlight .ne {
  color: #a6e22e;
}
.highlight .nf {
  color: #a6e22e;
}
.highlight .vc {
  color: #ffffff;
}
.highlight .nn {
  color: #ffffff;
}
.highlight .nl {
  color: #ffffff;
}
.highlight .ni {
  color: #ffffff;
}
.highlight .bp {
  color: #ffffff;
}
.highlight .vg {
  color: #ffffff;
}
.highlight .vi {
  color: #ffffff;
}
.highlight .nv {
  color: #ffffff;
}
.highlight .w {
  color: #ffffff;
}
.highlight {
  color: #ffffff;
}
.highlight .n, .highlight .py, .highlight .nx {
  color: #ffffff;
}
.highlight .ow {
  color: #f92672;
}
.highlight .nt {
  color: #f92672;
}
.highlight .k, .highlight .kv {
  color: #f92672;
}
.highlight .kn {
  color: #f92672;
}
.highlight .kp {
  color: #f92672;
}
.highlight .o {
  color: #f92672;
}
    </style>
    <link href="stylesheets/screen.css" rel="stylesheet" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" media="print" />
      <script src="javascripts/all.js"></script>
  </head>

  <body class="index" data-languages="[&quot;python&quot;,&quot;r&quot;,&quot;shell&quot;,&quot;vb&quot;]">
    <a href="#" id="nav-button">
      <span>
        NAV
        <img src="images/navbar.png" alt="Navbar" />
      </span>
    </a>
    <div class="toc-wrapper">
      <img src="images/logo.png" class="logo" alt="Logo" />
        <div class="lang-selector">
              <a href="#" data-language-name="python">python</a>
              <a href="#" data-language-name="r">r</a>
              <a href="#" data-language-name="shell">shell</a>
              <a href="#" data-language-name="vb">vb</a>
        </div>
        <div class="search">
          <input type="text" class="search" id="input-search" placeholder="Search">
        </div>
        <ul class="search-results"></ul>
      <ul id="toc" class="toc-list-h1">
          <li>
            <a href="#introduction" class="toc-h1 toc-link" data-title="Introduction">Introduction</a>
          </li>
          <li>
            <a href="#installation" class="toc-h1 toc-link" data-title="Installation">Installation</a>
          </li>
          <li>
            <a href="#authentication" class="toc-h1 toc-link" data-title="Authentication">Authentication</a>
          </li>
          <li>
            <a href="#submitting-your-first-query" class="toc-h1 toc-link" data-title="Submitting your first query">Submitting your first query</a>
          </li>
          <li>
            <a href="#query-types" class="toc-h1 toc-link" data-title="Query types">Query types</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#simple-queries" class="toc-h2 toc-link" data-title="Simple queries">Simple queries</a>
                  </li>
                  <li>
                    <a href="#queries-with-aggregations" class="toc-h2 toc-link" data-title="Queries with aggregations">Queries with aggregations</a>
                  </li>
                  <li>
                    <a href="#median-queries" class="toc-h2 toc-link" data-title="Median queries">Median queries</a>
                  </li>
                  <li>
                    <a href="#mean-average-queries" class="toc-h2 toc-link" data-title="Mean/average queries">Mean/average queries</a>
                  </li>
                  <li>
                    <a href="#combining-multiple-queries" class="toc-h2 toc-link" data-title="Combining multiple queries">Combining multiple queries</a>
                  </li>
                  <li>
                    <a href="#geojson-queries" class="toc-h2 toc-link" data-title="GeoJSON queries">GeoJSON queries</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#filters" class="toc-h1 toc-link" data-title="Filters">Filters</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#equaltofilter" class="toc-h2 toc-link" data-title="EqualToFilter"><code>EqualToFilter</code></a>
                  </li>
                  <li>
                    <a href="#betweenfilter" class="toc-h2 toc-link" data-title="BetweenFilter"><code>BetweenFilter</code></a>
                  </li>
                  <li>
                    <a href="#infilter" class="toc-h2 toc-link" data-title="InFilter"><code>InFilter</code></a>
                  </li>
                  <li>
                    <a href="#greaterthanfilter" class="toc-h2 toc-link" data-title="GreaterThanFilter"><code>GreaterThanFilter</code></a>
                  </li>
                  <li>
                    <a href="#greaterthanorequaltofilter" class="toc-h2 toc-link" data-title="GreaterThanOrEqualToFilter"><code>GreaterThanOrEqualToFilter</code></a>
                  </li>
                  <li>
                    <a href="#lessthanfilter" class="toc-h2 toc-link" data-title="LessThanFilter"><code>LessThanFilter</code></a>
                  </li>
                  <li>
                    <a href="#lessthanorequaltofilter" class="toc-h2 toc-link" data-title="LessThanOrEqualToFilter"><code>LessThanOrEqualToFilter</code></a>
                  </li>
                  <li>
                    <a href="#notequaltofilter" class="toc-h2 toc-link" data-title="NotEqualToFilter"><code>NotEqualToFilter</code></a>
                  </li>
                  <li>
                    <a href="#notinfilter" class="toc-h2 toc-link" data-title="NotInFilter"><code>NotInFilter</code></a>
                  </li>
                  <li>
                    <a href="#mileradiusfilter" class="toc-h2 toc-link" data-title="MileRadiusFilter"><code>MileRadiusFilter</code></a>
                  </li>
                  <li>
                    <a href="#drivetimefilter" class="toc-h2 toc-link" data-title="DrivetimeFilter"><code>DrivetimeFilter</code></a>
                  </li>
                  <li>
                    <a href="#intersectsfilter" class="toc-h2 toc-link" data-title="IntersectsFilter"><code>IntersectsFilter</code></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#aggregations" class="toc-h1 toc-link" data-title="Aggregations">Aggregations</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#sumaggregation" class="toc-h2 toc-link" data-title="SumAggregation"><code>SumAggregation</code></a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#sample-queries" class="toc-h1 toc-link" data-title="Sample queries">Sample queries</a>
              <ul class="toc-list-h2">
                  <li>
                    <a href="#population-density-in-the-boston-ma-msa" class="toc-h2 toc-link" data-title="Population density in the Boston, MA MSA">Population density in the Boston, MA MSA</a>
                  </li>
                  <li>
                    <a href="#population-within-five-miles-of-latitude-longitude-pair" class="toc-h2 toc-link" data-title="Population within five miles of latitude-longitude pair">Population within five miles of latitude-longitude pair</a>
                  </li>
              </ul>
          </li>
          <li>
            <a href="#submitting-multiple-queries" class="toc-h1 toc-link" data-title="Submitting multiple queries">Submitting multiple queries</a>
          </li>
      </ul>
        <ul class="toc-footer">
            <li><a href='https://stratodem.com'>StratoDem Analytics</a></li>
            <li><a href='https://github.com/StratoDem/strato-query'>strato-query repository</a></li>
            <li><a href='https://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <style>
.toc-wrapper .logo {
    max-width: 95%;
    margin-top: 14px;
    margin-left: 2.5%;
}
</style>
<h1 id='introduction'>Introduction</h1>
<p>Welcome to the StratoDem Analytics API! You can use the API to query economic and geo-demographic data from the StratoDem Analytics database.</p>

<p>We have language bindings in Python, R and VBA (for Excel). You can view code examples in the dark area to the right, and you can switch the programming language of the examples with the tabs in the top right.</p>
<h1 id='installation'>Installation</h1><pre class="highlight python tab-python"><code><span class="err">$</span> <span class="n">pip</span> <span class="n">install</span> <span class="n">strato</span><span class="o">-</span><span class="n">query</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">devtools</span><span class="p">)</span><span class="w">
</span><span class="n">devtools</span><span class="o">::</span><span class="n">install_github</span><span class="p">(</span><span class="s1">'StratoDem/strato-query'</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight vb tab-vb"><code><span class="c1">' Contact the StratoDem Analytics team for an Excel template including necessary query structures</span>
</code></pre><pre class="highlight shell tab-shell"><code><span class="c"># Just use curl!</span>
</code></pre>
<p>For Python or R, install the package from PyPI or GitHub.</p>

<p>For VBA support, contact the StratoDem team for an Excel template.</p>
<h1 id='authentication'>Authentication</h1>
<blockquote>
<p>To authorize, use this code:</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query</span> <span class="kn">import</span> <span class="n">authenticate_to_api</span>

<span class="c"># Option 1: Pass in the API token as a string</span>
<span class="n">authenticate_to_api</span><span class="p">(</span><span class="s">'my-api-token'</span><span class="p">)</span>

<span class="c"># Option 2: Pass in the API token via an environment variable at STRATODEM_API_TOKEN</span>
<span class="c"># This would be, e.g., $ STRATODEM_API_TOKEN=my-api-token python my_api_script.py</span>
<span class="n">authenticate_to_api</span><span class="p">()</span>

<span class="c"># API calls from this point on will now query the API with API_TOKEN</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="c1"># This requires an apiToken argument for each submitted API query
</span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">submit_api_query</span><span class="p">(</span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">myQueryParams</span><span class="p">,</span><span class="w"> </span><span class="n">apiToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'my-api-token'</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>curl -X POST <span class="s2">"https://api.stratodem.com/api"</span> <span class="se">\</span>
    -H <span class="s2">"accept: application/json"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -d <span class="s2">"{ </span><span class="se">\"</span><span class="s2">token</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">my-api-token</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">query</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">MEDIAN</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, { </span><span class="se">\"</span><span class="s2">median_value</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">median_income</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">incomeforecast_us_annual_income_group_age</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">ge</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 17, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">age_g</span><span class="se">\"</span><span class="s2"> }, { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">between</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: [ 2010, 2013 ], </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">order</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">median_variable_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">income_g</span><span class="se">\"</span><span class="s2">}}"</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="c1">' Pass a valid API token to the query</span>
<span class="c1">' If you are using the provided template, you can place the API token in the Configuration!B5 cell</span>
</code></pre>
<p>StratoDem Analytics uses API keys to allow access to the API. You can register a new StratoDem Analytics API key from your <a href="https://clients.stratodem.com/account">account page</a>.</p>

<p><a href="https://academy.stratodem.com/article/82-creating-and-managing-api-tokens">How do I create a new API token or find an existing token? &rarr;</a></p>

<aside class="notice">
You must replace <code>my-api-token</code> with your personal API key.
</aside>
<h1 id='submitting-your-first-query'>Submitting your first query</h1>
<blockquote>
<p>Finds median household income in the US for those 80+ from 2010 to 2013</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query</span> <span class="kn">import</span> <span class="n">SDAPIQuery</span><span class="p">,</span> <span class="n">APIMedianQueryParams</span>
<span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">GreaterThanOrEqualToFilter</span><span class="p">,</span> <span class="n">BetweenFilter</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">SDAPIQuery</span><span class="o">.</span><span class="n">query_api_df</span><span class="p">(</span>
    <span class="n">query_params</span><span class="o">=</span><span class="n">APIMedianQueryParams</span><span class="p">(</span>
        <span class="n">query_type</span><span class="o">=</span><span class="s">'MEDIAN'</span><span class="p">,</span>
        <span class="n">table</span><span class="o">=</span><span class="s">'incomeforecast_us_annual_income_group_age'</span><span class="p">,</span>
        <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="p">{</span><span class="s">'median_value'</span><span class="p">:</span> <span class="s">'median_income'</span><span class="p">}),</span>
        <span class="n">median_variable_name</span><span class="o">=</span><span class="s">'income_g'</span><span class="p">,</span>
        <span class="n">data_filters</span><span class="o">=</span><span class="p">(</span>
            <span class="n">GreaterThanOrEqualToFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'age_g'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">17</span><span class="p">),</span>
            <span class="n">BetweenFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'year'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="p">[</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2013</span><span class="p">]),</span>
        <span class="p">),</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,),</span>
        <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,),</span>
        <span class="n">aggregations</span><span class="o">=</span><span class="p">(),</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">
</span><span class="n">apiToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'my-api-token'</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">submit_api_query</span><span class="p">(</span><span class="w">
  </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">median_query_params</span><span class="p">(</span><span class="w">
    </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'incomeforecast_us_annual_income_group_age'</span><span class="p">,</span><span class="w">
    </span><span class="n">data_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_fields</span><span class="p">(</span><span class="n">fields_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">median_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'median_hhi'</span><span class="p">))),</span><span class="w">
    </span><span class="n">data_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
        </span><span class="n">ge_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'age_g'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">17</span><span class="p">),</span><span class="w">
        </span><span class="n">between_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="m">2013</span><span class="p">))</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">groupby</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'year'</span><span class="p">),</span><span class="w">
    </span><span class="n">median_variable_name</span><span class="o">=</span><span class="s1">'income_g'</span><span class="p">,</span><span class="w">
    </span><span class="n">aggregations</span><span class="o">=</span><span class="nf">list</span><span class="p">()</span><span class="w">
  </span><span class="p">),</span><span class="w">
  </span><span class="n">apiToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apiToken</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>curl -X POST <span class="s2">"https://api.stratodem.com/api"</span> <span class="se">\</span>
    -H <span class="s2">"accept: application/json"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -d <span class="s2">"{ </span><span class="se">\"</span><span class="s2">token</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">my-api-token</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">query</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">MEDIAN</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, { </span><span class="se">\"</span><span class="s2">median_value</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">median_income</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">incomeforecast_us_annual_income_group_age</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">ge</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 17, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">age_g</span><span class="se">\"</span><span class="s2"> }, { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">between</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: [ 2010, 2013 ], </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">order</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">median_variable_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">income_g</span><span class="se">\"</span><span class="s2">}}"</span>
</code></pre>
<p>A basic query to the StratoDem Analytics API submits query parameters with authentication via the API token.</p>
<h1 id='query-types'>Query types</h1><h2 id='simple-queries'>Simple queries</h2>
<blockquote>
<p>This query returns households by age, income group, and year for all census tracts in Massachusetts starting in 2010</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query</span> <span class="kn">import</span> <span class="n">SDAPIQuery</span><span class="p">,</span> <span class="n">APIQueryParams</span>
<span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">EqualToFilter</span><span class="p">,</span> <span class="n">GreaterThanOrEqualToFilter</span>

<span class="n">SDAPIQuery</span><span class="o">.</span><span class="n">query_api_df</span><span class="p">(</span>
    <span class="n">APIQueryParams</span><span class="p">(</span>
        <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'geoid11'</span><span class="p">,</span> <span class="s">'age_g'</span><span class="p">,</span> <span class="s">'income_g'</span><span class="p">,</span> <span class="s">'households'</span><span class="p">),</span>
        <span class="n">table</span><span class="o">=</span><span class="s">'incomeforecast_tract_annual_income_group_age'</span><span class="p">,</span>
        <span class="n">data_filters</span><span class="o">=</span><span class="p">[</span>
            <span class="n">EqualToFilter</span><span class="p">(</span><span class="s">'geoid2'</span><span class="p">,</span> <span class="mi">25</span><span class="p">),</span>
            <span class="n">GreaterThanOrEqualToFilter</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="mi">2010</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">aggregations</span><span class="o">=</span><span class="p">(),</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">()))</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">submit_api_query</span><span class="p">(</span><span class="w">
  </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_query_params</span><span class="p">(</span><span class="w">
    </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'incomeforecast_tract_annual_income_group_age'</span><span class="p">,</span><span class="w">
    </span><span class="n">data_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_fields</span><span class="p">(</span><span class="n">fields_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="s1">'geoid11'</span><span class="p">,</span><span class="w"> </span><span class="s1">'age_g'</span><span class="p">,</span><span class="w"> </span><span class="s1">'income_g'</span><span class="p">,</span><span class="w"> </span><span class="s1">'households'</span><span class="p">)),</span><span class="w">
    </span><span class="n">data_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
        </span><span class="n">eq_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'geoid2'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">25</span><span class="p">),</span><span class="w">
        </span><span class="n">ge_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2010</span><span class="p">)</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">aggregations</span><span class="o">=</span><span class="nf">list</span><span class="p">(),</span><span class="w">
    </span><span class="n">groupby</span><span class="o">=</span><span class="nf">list</span><span class="p">()</span><span class="w">
  </span><span class="p">),</span><span class="w">
  </span><span class="n">apiToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apiToken</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>curl -X POST <span class="s2">"https://api.stratodem.com/api"</span> <span class="se">\</span>
    -H <span class="s2">"accept: application/json"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -d <span class="s2">"{ </span><span class="se">\"</span><span class="s2">token</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">my-api-token</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">query</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">COUNT</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">geoid11</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">age_g</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">income_g</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">households</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">incomeforecast_tract_annual_income_group_age</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [ ], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 25, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">geoid2</span><span class="se">\"</span><span class="s2"> }, { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">ge</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 2010, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">order</span><span class="se">\"</span><span class="s2">: []}}"</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="k">Dim</span> <span class="nv">query</span> <span class="ow">As</span> <span class="n">Dictionary</span>

<span class="k">Set</span> <span class="n">query</span> <span class="o">=</span> <span class="n">apiQueryParameters</span><span class="p">(</span> <span class="n">_</span>
    <span class="n">table</span><span class="p">:</span><span class="o">=</span><span class="s">"incomeforecast_tract_annual_income_group_age"</span><span class="p">,</span> <span class="n">_</span>
    <span class="n">dataFields</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"year"</span><span class="p">,</span> <span class="s">"geoid11"</span><span class="p">,</span> <span class="s">"age_g"</span><span class="p">,</span> <span class="s">"income_g"</span><span class="p">,</span> <span class="s">"households"</span><span class="p">),</span> <span class="n">_</span>
    <span class="n">dataFilters</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span> <span class="n">_</span>
        <span class="n">equalToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"geoid2"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">25</span><span class="p">),</span> <span class="n">_</span>
        <span class="n">greaterThanOrEqualToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"year"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">2010</span><span class="p">)),</span> <span class="n">_</span>
    <span class="n">groupby</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(),</span> <span class="n">_</span>
    <span class="n">aggregations</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">())</span>

<span class="c1">' Write the results to "Example Sheet" (note that this sheet will need to exist first)</span>
<span class="k">Call</span> <span class="n">writeToSheet</span><span class="p">(</span><span class="n">results</span><span class="p">:</span><span class="o">=</span><span class="n">submitAPIQuery</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">sheetName</span><span class="p">:</span><span class="o">=</span><span class="s">"Example Sheet"</span><span class="p">)</span>
</code></pre>
<p>Basic API queries evaluate like simple <code>SELECT</code> statements from the StratoDem Analytics database.</p>

<p>Queries roughly translate into SQL as <code>SELECT data_fields FROM table WHERE data_filters GROUP BY groupby;</code></p>
<h2 id='queries-with-aggregations'>Queries with aggregations</h2>
<blockquote>
<p>This query returns the number of households age 75+ with at least $50,000 in household income by county and year for each county in California</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query</span> <span class="kn">import</span> <span class="n">SDAPIQuery</span><span class="p">,</span> <span class="n">APIQueryParams</span>
<span class="kn">from</span> <span class="nn">strato_query.aggregations</span> <span class="kn">import</span> <span class="n">SumAggregation</span>
<span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">EqualToFilter</span><span class="p">,</span> <span class="n">GreaterThanOrEqualToFilter</span>

<span class="n">SDAPIQuery</span><span class="o">.</span><span class="n">query_api_df</span><span class="p">(</span>
    <span class="n">APIQueryParams</span><span class="p">(</span>
        <span class="c"># Passing in a dictionary to data_fields allows for renaming variables in the resulting DataFrame or JSON</span>
        <span class="n">data_fields</span><span class="o">=</span><span class="p">[</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'geoid5'</span><span class="p">,</span> <span class="p">{</span><span class="s">'households'</span><span class="p">:</span> <span class="s">'households_age_75plus_hhi_50k_plus'</span><span class="p">}],</span>
        <span class="n">table</span><span class="o">=</span><span class="s">'incomeforecast_county_annual_income_group_age'</span><span class="p">,</span>
        <span class="n">data_filters</span><span class="o">=</span><span class="p">(</span>
            <span class="n">EqualToFilter</span><span class="p">(</span><span class="s">'geoid2'</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span>
            <span class="c"># Cutoff for age 75+</span>
            <span class="n">GreaterThanOrEqualToFilter</span><span class="p">(</span><span class="s">'age_g'</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>
            <span class="c"># Cutoff for $50,000+ HHI</span>
            <span class="n">GreaterThanOrEqualToFilter</span><span class="p">(</span><span class="s">'income_g'</span><span class="p">,</span> <span class="mi">10</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'geoid5'</span><span class="p">),</span>
        <span class="n">aggregations</span><span class="o">=</span><span class="p">[</span><span class="n">SumAggregation</span><span class="p">(</span><span class="s">'households'</span><span class="p">)],</span>
        <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'geoid5'</span><span class="p">)</span>
    <span class="p">))</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">submit_api_query</span><span class="p">(</span><span class="w">
  </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_query_params</span><span class="p">(</span><span class="w">
    </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'incomeforecast_county_annual_income_group_age'</span><span class="p">,</span><span class="w">
    </span><span class="c1"># Passing in a mapping to data_fields allows for renaming variables in the resulting data.frame or JSON
</span><span class="w">    </span><span class="n">data_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_fields</span><span class="p">(</span><span class="n">fields_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="s1">'geoid5'</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">households</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'households_age_75plus_50k_plus'</span><span class="p">))),</span><span class="w">
    </span><span class="n">data_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
        </span><span class="n">eq_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'geoid2'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">6</span><span class="p">),</span><span class="w">
        </span><span class="c1"># Cutoff for age 75+
</span><span class="w">        </span><span class="n">ge_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'age_g'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">16</span><span class="p">),</span><span class="w">
        </span><span class="c1"># Cutoff for $50,000+ HHI
</span><span class="w">        </span><span class="n">ge_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'income_g'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">10</span><span class="p">)</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">aggregations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">sum_aggregation</span><span class="p">(</span><span class="n">variable_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'households'</span><span class="p">)),</span><span class="w">
    </span><span class="n">groupby</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="s1">'geoid5'</span><span class="p">),</span><span class="w">
    </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="s1">'geoid5'</span><span class="p">)</span><span class="w">
  </span><span class="p">),</span><span class="w">
  </span><span class="n">apiToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apiToken</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>curl -X POST <span class="s2">"https://api.stratodem.com/api"</span> <span class="se">\</span>
    -H <span class="s2">"accept: application/json"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -d <span class="s2">"{</span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">COUNT</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">geoid5</span><span class="se">\"</span><span class="s2">, {</span><span class="se">\"</span><span class="s2">households</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">households_age_75plus_hhi_50k_plus</span><span class="se">\"</span><span class="s2">}], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">incomeforecast_county_annual_income_group_age</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">geoid5</span><span class="se">\"</span><span class="s2">], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [{</span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 6, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">geoid2</span><span class="se">\"</span><span class="s2">}, {</span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">ge</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 16, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">age_g</span><span class="se">\"</span><span class="s2">}, {</span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">ge</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 10, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">income_g</span><span class="se">\"</span><span class="s2">}], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [{</span><span class="se">\"</span><span class="s2">aggregation_func</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">sum</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">variable_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">households</span><span class="se">\"</span><span class="s2">}], </span><span class="se">\"</span><span class="s2">order</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">geoid5</span><span class="se">\"</span><span class="s2">]}"</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="k">Dim</span> <span class="nv">query</span> <span class="ow">As</span> <span class="n">Dictionary</span>

<span class="k">Set</span> <span class="n">query</span> <span class="o">=</span> <span class="n">apiQueryParameters</span><span class="p">(</span> <span class="n">_</span>
    <span class="n">table</span><span class="p">:</span><span class="o">=</span><span class="s">"incomeforecast_county_annual_income_group_age"</span><span class="p">,</span> <span class="n">_</span>
    <span class="n">dataFields</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"year"</span><span class="p">,</span> <span class="s">"geoid5"</span><span class="p">,</span> <span class="n">renameVariable</span><span class="p">(</span><span class="n">original</span><span class="p">:</span><span class="o">=</span><span class="s">"households"</span><span class="p">,</span> <span class="n">renamed</span><span class="p">:</span><span class="o">=</span><span class="s">"households_age_75plus_hhi_50k_plus"</span><span class="p">)),</span> <span class="n">_</span>
    <span class="n">dataFilters</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span> <span class="n">_</span>
        <span class="n">equalToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"geoid2"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">6</span><span class="p">),</span> <span class="n">_</span>
        <span class="n">greaterThanOrEqualToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"age_g"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">16</span><span class="p">),</span> <span class="n">_</span>
        <span class="n">greaterThanOrEqualToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"income_g"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">10</span><span class="p">)),</span> <span class="n">_</span>
    <span class="n">groupby</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"year"</span><span class="p">,</span> <span class="s">"geoid5"</span><span class="p">),</span> <span class="n">_</span>
    <span class="n">order</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"year"</span><span class="p">,</span> <span class="s">"geoid5"</span><span class="p">),</span> <span class="n">_</span>
    <span class="n">aggregations</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="n">sumAggregation</span><span class="p">(</span><span class="n">variableName</span><span class="p">:</span><span class="o">=</span><span class="s">"households"</span><span class="p">)))</span>

<span class="c1">' Write the results to "Example Sheet" (note that this sheet will need to exist first)</span>
<span class="k">Call</span> <span class="n">writeToSheet</span><span class="p">(</span><span class="n">results</span><span class="p">:</span><span class="o">=</span><span class="n">submitAPIQuery</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">sheetName</span><span class="p">:</span><span class="o">=</span><span class="s">"Example Sheet"</span><span class="p">)</span>
</code></pre>
<p>In many cases, we want to aggregate data returned by the API. For example, if we have the SQL query:
<code>SELECT year, geoid5, sum(households) FROM incomeforecast_county_annual_income_group_age WHERE income_g &gt;= 5 AND age_g &gt;= 17 GROUP BY year, geoid5 ORDER BY year, geoid5;</code>, 
we need to group by the <code>year</code> and <code>geoid5</code> (county) columns, and then get the sum of <code>households</code> for each combination.</p>

<p>The <code>groupby</code> and <code>aggregations</code> arguments tell the API which columns to group on and which aggregations to apply.</p>
<h2 id='median-queries'>Median queries</h2>
<blockquote>
<p>This query returns the median household income for all households by census tract in Suffolk County, MA in 2019</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query</span> <span class="kn">import</span> <span class="n">SDAPIQuery</span><span class="p">,</span> <span class="n">APIMedianQueryParams</span>
<span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">EqualToFilter</span>

<span class="n">SDAPIQuery</span><span class="o">.</span><span class="n">query_api_df</span><span class="p">(</span>
    <span class="n">APIMedianQueryParams</span><span class="p">(</span>
        <span class="n">median_variable_name</span><span class="o">=</span><span class="s">'income_g'</span><span class="p">,</span>
        <span class="n">table</span><span class="o">=</span><span class="s">'incomeforecast_tract_annual_income_group'</span><span class="p">,</span>
        <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'geoid11'</span><span class="p">,</span> <span class="s">'median_value'</span><span class="p">),</span>
        <span class="n">data_filters</span><span class="o">=</span><span class="p">[</span>
            <span class="n">EqualToFilter</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="mi">2019</span><span class="p">),</span>
            <span class="n">EqualToFilter</span><span class="p">(</span><span class="s">'geoid5'</span><span class="p">,</span> <span class="mi">25025</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">aggregations</span><span class="o">=</span><span class="p">(),</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'geoid11'</span><span class="p">)</span>       
    <span class="p">))</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">submit_api_query</span><span class="p">(</span><span class="w">
  </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">median_query_params</span><span class="p">(</span><span class="w">
    </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'incomeforecast_tract_annual_income_group'</span><span class="p">,</span><span class="w">
    </span><span class="n">data_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_fields</span><span class="p">(</span><span class="n">fields_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="s1">'geoid11'</span><span class="p">,</span><span class="w"> </span><span class="s1">'median_value'</span><span class="p">)),</span><span class="w">
    </span><span class="n">data_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
        </span><span class="n">eq_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2019</span><span class="p">),</span><span class="w">
        </span><span class="n">eq_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'geoid5'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">25025</span><span class="p">)</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">groupby</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="s1">'geoid11'</span><span class="p">),</span><span class="w">
    </span><span class="n">median_variable_name</span><span class="o">=</span><span class="s1">'income_g'</span><span class="p">,</span><span class="w">
    </span><span class="n">aggregations</span><span class="o">=</span><span class="nf">list</span><span class="p">()</span><span class="w">
  </span><span class="p">),</span><span class="w">
  </span><span class="n">apiToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apiToken</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>curl -X POST <span class="s2">"https://api.stratodem.com/api"</span> <span class="se">\</span>
    -H <span class="s2">"accept: application/json"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    - d <span class="s2">"{</span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">MEDIAN</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">geoid11</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">median_value</span><span class="se">\"</span><span class="s2">], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">incomeforecast_tract_annual_income_group</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">geoid11</span><span class="se">\"</span><span class="s2">], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [{</span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 2019, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">}, {</span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 25025, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">geoid5</span><span class="se">\"</span><span class="s2">}], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">median_variable_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">income_g</span><span class="se">\"</span><span class="s2">}"</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="k">Dim</span> <span class="nv">query</span> <span class="ow">As</span> <span class="n">Dictionary</span>

<span class="k">Set</span> <span class="n">query</span> <span class="o">=</span> <span class="n">medianQueryParameters</span><span class="p">(</span> <span class="n">_</span>
    <span class="n">table</span><span class="p">:</span><span class="o">=</span><span class="s">"incomeforecast_tract_annual_income_group"</span><span class="p">,</span> <span class="n">_</span>
    <span class="n">dataFields</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"year"</span><span class="p">,</span> <span class="s">"geoid11"</span><span class="p">,</span> <span class="s">"median_value"</span><span class="p">),</span> <span class="n">_</span>
    <span class="n">dataFilters</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="n">equalToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"year"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">2019</span><span class="p">),</span> <span class="n">equalToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"geoid5"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">25025</span><span class="p">)),</span> <span class="n">_</span>
    <span class="n">aggregations</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(),</span> <span class="n">_</span>
    <span class="n">groupby</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"year"</span><span class="p">,</span> <span class="s">"geoid11"</span><span class="p">),</span> <span class="n">_</span>
    <span class="n">medianVariableName</span><span class="p">:</span><span class="o">=</span><span class="s">"income_g"</span><span class="p">)</span>

<span class="c1">' Write the results to "Example Sheet" (note that this sheet will need to exist first)</span>
<span class="k">Call</span> <span class="n">writeToSheet</span><span class="p">(</span><span class="n">results</span><span class="p">:</span><span class="o">=</span><span class="n">submitAPIQuery</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">sheetName</span><span class="p">:</span><span class="o">=</span><span class="s">"Example Sheet"</span><span class="p">)</span>
</code></pre>
<p>To query median household income, net worth, home values, or other metrics, a special median query is needed.</p>

<p>These queries require a <code>median_variable_name</code> argument, which tells the API service which variable to 
use to compute the median value.</p>
<h2 id='mean-average-queries'>Mean/average queries</h2>
<blockquote>
<p>This query returns the median household income for all households by census tract in Suffolk County, MA in 2019</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query</span> <span class="kn">import</span> <span class="n">SDAPIQuery</span><span class="p">,</span> <span class="n">APIMeanQueryParams</span>
<span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">EqualToFilter</span>

<span class="n">SDAPIQuery</span><span class="o">.</span><span class="n">query_api_df</span><span class="p">(</span>
    <span class="n">APIMeanQueryParams</span><span class="p">(</span>
        <span class="n">mean_variable_name</span><span class="o">=</span><span class="s">'income_g'</span><span class="p">,</span>
        <span class="n">table</span><span class="o">=</span><span class="s">'incomeforecast_tract_annual_income_group'</span><span class="p">,</span>
        <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'geoid11'</span><span class="p">,</span> <span class="s">'mean_value'</span><span class="p">),</span>
        <span class="n">data_filters</span><span class="o">=</span><span class="p">[</span>
            <span class="n">EqualToFilter</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="mi">2019</span><span class="p">),</span>
            <span class="n">EqualToFilter</span><span class="p">(</span><span class="s">'geoid5'</span><span class="p">,</span> <span class="mi">25025</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">aggregations</span><span class="o">=</span><span class="p">(),</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'geoid11'</span><span class="p">)</span>       
    <span class="p">))</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">submit_api_query</span><span class="p">(</span><span class="w">
  </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">mean_query_params</span><span class="p">(</span><span class="w">
    </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'incomeforecast_tract_annual_income_group'</span><span class="p">,</span><span class="w">
    </span><span class="n">data_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_fields</span><span class="p">(</span><span class="n">fields_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="s1">'geoid11'</span><span class="p">,</span><span class="w"> </span><span class="s1">'mean_value'</span><span class="p">)),</span><span class="w">
    </span><span class="n">data_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
        </span><span class="n">eq_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2019</span><span class="p">),</span><span class="w">
        </span><span class="n">eq_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'geoid5'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">25025</span><span class="p">)</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">groupby</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="s1">'geoid11'</span><span class="p">),</span><span class="w">
    </span><span class="n">mean_variable_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'income_g'</span><span class="p">,</span><span class="w">
    </span><span class="n">aggregations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">()</span><span class="w">
  </span><span class="p">),</span><span class="w">
  </span><span class="n">apiToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apiToken</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>curl -X POST <span class="s2">"https://api.stratodem.com/api"</span> <span class="se">\</span>
    -H <span class="s2">"accept: application/json"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    - d <span class="s2">"{</span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">MEAN</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">geoid11</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">mean_value</span><span class="se">\"</span><span class="s2">], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">incomeforecast_tract_annual_income_group</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">geoid11</span><span class="se">\"</span><span class="s2">], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [{</span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 2019, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">}, {</span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 25025, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">geoid5</span><span class="se">\"</span><span class="s2">}], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">mean_variable_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">income_g</span><span class="se">\"</span><span class="s2">}"</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="k">Dim</span> <span class="nv">query</span> <span class="ow">As</span> <span class="n">Dictionary</span>

<span class="k">Set</span> <span class="n">query</span> <span class="o">=</span> <span class="n">meanQueryParameters</span><span class="p">(</span> <span class="n">_</span>
    <span class="n">table</span><span class="p">:</span><span class="o">=</span><span class="s">"incomeforecast_tract_annual_income_group"</span><span class="p">,</span> <span class="n">_</span>
    <span class="n">dataFields</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"year"</span><span class="p">,</span> <span class="s">"geoid11"</span><span class="p">,</span> <span class="s">"mean_value"</span><span class="p">),</span> <span class="n">_</span>
    <span class="n">dataFilters</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="n">equalToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"year"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">2019</span><span class="p">),</span> <span class="n">equalToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"geoid5"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">25025</span><span class="p">)),</span> <span class="n">_</span>
    <span class="n">aggregations</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(),</span> <span class="n">_</span>
    <span class="n">groupby</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"year"</span><span class="p">,</span> <span class="s">"geoid11"</span><span class="p">),</span> <span class="n">_</span>
    <span class="n">meanVariableName</span><span class="p">:</span><span class="o">=</span><span class="s">"income_g"</span><span class="p">)</span>

<span class="c1">' Write the results to "Example Sheet" (note that this sheet will need to exist first)</span>
<span class="k">Call</span> <span class="n">writeToSheet</span><span class="p">(</span><span class="n">results</span><span class="p">:</span><span class="o">=</span><span class="n">submitAPIQuery</span><span class="p">(</span><span class="n">query</span><span class="p">),</span> <span class="n">sheetName</span><span class="p">:</span><span class="o">=</span><span class="s">"Example Sheet"</span><span class="p">)</span>
</code></pre>
<p>To query mean household income, net worth, home values, or other metrics, a special mean query is needed.</p>

<p>These queries require a <code>mean_variable_name</code> argument, which tells the API service which variable to 
use to compute the mean value.</p>
<h2 id='combining-multiple-queries'>Combining multiple queries</h2>
<blockquote>
<p>This query joins two results on common columns to compute population density</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query</span> <span class="kn">import</span> <span class="n">SDAPIQuery</span><span class="p">,</span> <span class="n">APIQueryParams</span>
<span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">EqualToFilter</span><span class="p">,</span> <span class="n">LessThanFilter</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">SDAPIQuery</span><span class="o">.</span><span class="n">query_api_df</span><span class="p">(</span>
    <span class="n">query_params</span><span class="o">=</span><span class="n">APIQueryParams</span><span class="p">(</span>
        <span class="n">query_type</span><span class="o">=</span><span class="s">'COUNT'</span><span class="p">,</span>
        <span class="n">table</span><span class="o">=</span><span class="s">'populationforecast_metro_annual_population'</span><span class="p">,</span>
        <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'cbsa'</span><span class="p">,</span> <span class="p">{</span><span class="s">'population'</span><span class="p">:</span> <span class="s">'population'</span><span class="p">}),</span>
        <span class="n">data_filters</span><span class="o">=</span><span class="p">(</span>
            <span class="n">LessThanFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'year'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">2015</span><span class="p">),</span>
            <span class="n">EqualToFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'cbsa'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">14454</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">aggregations</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">aggregation_func</span><span class="o">=</span><span class="s">'sum'</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s">'population'</span><span class="p">),),</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">(</span><span class="s">'cbsa'</span><span class="p">,</span> <span class="s">'year'</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,),</span>
        <span class="n">join</span><span class="o">=</span><span class="n">APIQueryParams</span><span class="p">(</span>
            <span class="n">query_type</span><span class="o">=</span><span class="s">'AREA'</span><span class="p">,</span>
            <span class="n">table</span><span class="o">=</span><span class="s">'geocookbook_metro_na_shapes_full'</span><span class="p">,</span>
            <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s">'cbsa'</span><span class="p">,</span> <span class="s">'area'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">),</span>
            <span class="n">data_filters</span><span class="o">=</span><span class="p">[</span><span class="n">EqualToFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'cbsa'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">14454</span><span class="p">)],</span>
            <span class="n">groupby</span><span class="o">=</span><span class="p">(</span><span class="s">'cbsa'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">),</span>
            <span class="n">aggregations</span><span class="o">=</span><span class="p">(),</span>
            <span class="n">on</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="s">'cbsa'</span><span class="p">,),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="s">'cbsa'</span><span class="p">,)),</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s">'POP_PER_SQ_MI'</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s">'POPULATION'</span><span class="p">]</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s">'AREA'</span><span class="p">])</span>
<span class="n">df_final</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s">'YEAR'</span><span class="p">,</span> <span class="s">'NAME'</span><span class="p">,</span> <span class="s">'POP_PER_SQ_MI'</span><span class="p">]]</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">api_query_params</span><span class="p">(</span><span class="w">
  </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'populationforecast_metro_annual_population'</span><span class="p">,</span><span class="w">
  </span><span class="n">data_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_fields</span><span class="p">(</span><span class="n">fields_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="s1">'cbsa'</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'population'</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'population'</span><span class="p">))),</span><span class="w">
  </span><span class="n">data_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">lt_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"year"</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2015</span><span class="p">),</span><span class="w"> </span><span class="n">eq_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cbsa"</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14454</span><span class="p">)),</span><span class="w">
  </span><span class="n">aggregations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">sum_aggregation</span><span class="p">(</span><span class="n">variable_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"population"</span><span class="p">)),</span><span class="w">
  </span><span class="n">groupby</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"cbsa"</span><span class="p">,</span><span class="w"> </span><span class="s2">"year"</span><span class="p">),</span><span class="w">
  </span><span class="n">order</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"year"</span><span class="p">),</span><span class="w">
  </span><span class="n">join</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_query_params</span><span class="p">(</span><span class="w">
      </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'geocookbook_metro_na_shapes_full'</span><span class="p">,</span><span class="w">
      </span><span class="n">data_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_fields</span><span class="p">(</span><span class="n">fields_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'cbsa'</span><span class="p">,</span><span class="w"> </span><span class="s1">'area'</span><span class="p">,</span><span class="w"> </span><span class="s1">'name'</span><span class="p">)),</span><span class="w">
      </span><span class="n">data_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">eq_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"cbsa"</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14454</span><span class="p">)),</span><span class="w">
      </span><span class="n">aggregations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(),</span><span class="w">
      </span><span class="n">groupby</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s2">"cbsa"</span><span class="p">,</span><span class="w"> </span><span class="s2">"name"</span><span class="p">),</span><span class="w">
      </span><span class="n">on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'cbsa'</span><span class="p">),</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'cbsa'</span><span class="p">)),</span><span class="w">
      </span><span class="n">query_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"AREA"</span><span class="p">),</span><span class="w">
  </span><span class="n">query_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"COUNT"</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>curl -X POST <span class="s2">"https://api.stratodem.com/api"</span> <span class="se">\</span>
    -H <span class="s2">"accept: application/json"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    - d <span class="s2">"{</span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">COUNT</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, {</span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2">}], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">populationforecast_metro_annual_population</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [{</span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">lt</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 2015, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">}, {</span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 14454, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">}], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [{</span><span class="se">\"</span><span class="s2">aggregation_func</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">sum</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">variable_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2">}], </span><span class="se">\"</span><span class="s2">join</span><span class="se">\"</span><span class="s2">: {</span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">AREA</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">area</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2">], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">geocookbook_metro_na_shapes_full</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2">], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [{</span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 14454, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">}], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">on</span><span class="se">\"</span><span class="s2">: {</span><span class="se">\"</span><span class="s2">left</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">], </span><span class="se">\"</span><span class="s2">right</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">]}}, </span><span class="se">\"</span><span class="s2">order</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">]}"</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">apiQueryParameters</span><span class="p">(</span> <span class="n">_</span>
    <span class="n">table</span><span class="p">:</span><span class="o">=</span><span class="s">"populationforecast_metro_annual_population"</span><span class="p">,</span> <span class="n">_</span>
    <span class="n">dataFields</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"year"</span><span class="p">,</span> <span class="s">"cbsa"</span><span class="p">,</span> <span class="n">renameVariable</span><span class="p">(</span><span class="n">original</span><span class="p">:</span><span class="o">=</span><span class="s">"population"</span><span class="p">,</span> <span class="n">renamed</span><span class="p">:</span><span class="o">=</span><span class="s">"population"</span><span class="p">)),</span> <span class="n">_</span>
    <span class="n">dataFilters</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="n">lessThanFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"year"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">2015</span><span class="p">),</span> <span class="n">equalToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"cbsa"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">14454</span><span class="p">)),</span> <span class="n">_</span>
    <span class="n">aggregations</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="n">sumAggregation</span><span class="p">(</span><span class="n">variableName</span><span class="p">:</span><span class="o">=</span><span class="s">"population"</span><span class="p">)),</span> <span class="n">_</span>
    <span class="n">groupby</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"cbsa"</span><span class="p">,</span> <span class="s">"year"</span><span class="p">),</span> <span class="n">order</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"year"</span><span class="p">),</span> <span class="n">_</span>
    <span class="n">join</span><span class="p">:</span><span class="o">=</span><span class="n">apiQueryParameters</span><span class="p">(</span> <span class="n">_</span>
        <span class="n">table</span><span class="p">:</span><span class="o">=</span><span class="s">"geocookbook_metro_na_shapes_full"</span><span class="p">,</span> <span class="n">_</span>
        <span class="n">dataFields</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"cbsa"</span><span class="p">,</span> <span class="s">"area"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">),</span> <span class="n">_</span>
        <span class="n">dataFilters</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="n">equalToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"cbsa"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">14454</span><span class="p">)),</span> <span class="n">_</span>
        <span class="n">aggregations</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(),</span> <span class="n">_</span>
        <span class="n">groupby</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"cbsa"</span><span class="p">,</span> <span class="s">"name"</span><span class="p">),</span> <span class="n">_</span>
        <span class="n">joinOn</span><span class="p">:</span><span class="o">=</span><span class="n">joinOnStructure</span><span class="p">(</span><span class="n">left</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"cbsa"</span><span class="p">),</span> <span class="n">right</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="s">"cbsa"</span><span class="p">)),</span> <span class="n">_</span>
        <span class="n">queryType</span><span class="p">:</span><span class="o">=</span><span class="s">"AREA"</span><span class="p">),</span> <span class="n">_</span>
    <span class="n">queryType</span><span class="p">:</span><span class="o">=</span><span class="s">"COUNT"</span><span class="p">)</span>
</code></pre>
<p>In many cases, we need to derive data from two or more variables. For example, when calculating 
population density, we need to take the population and divide by the area. In this case, those two 
metrics come from different sources in the StratoDem Analytics database, and we need to <code>JOIN</code> two queries 
using the <code>join</code> argument. </p>

<p>A <code>join</code> takes another <code>APIQueryParams</code> object to join (effectively joining the results of two SELECT statements),
with that new <code>APIQueryParams</code> object requiring an <code>on</code> argument, to tell the API service which column(s) to join on.</p>

<p>For example, <code>on={&quot;left&quot;: [cbsa], &quot;right&quot;: [cbsa]}</code> tells the API to join the two subqueries on the <code>cbsa</code> column.</p>
<h2 id='geojson-queries'>GeoJSON queries</h2>
<blockquote>
<p>This query returns a GeoJSON FeatureCollection with median household income stored in properties for all census tracts within a 15-minute drive of the lat-lng</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query</span> <span class="kn">import</span> <span class="n">SDAPIQuery</span><span class="p">,</span> <span class="n">APIGeoJSONQueryParams</span><span class="p">,</span> <span class="n">APIMedianQueryParams</span>
<span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">EqualToFilter</span><span class="p">,</span> <span class="n">DrivetimeFilter</span>

<span class="n">geojson</span> <span class="o">=</span> <span class="n">SDAPIQuery</span><span class="o">.</span><span class="n">query_api_json</span><span class="p">(</span>
    <span class="n">APIGeoJSONQueryParams</span><span class="p">(</span>
        <span class="n">properties</span><span class="o">=</span><span class="p">[</span>
            <span class="s">'geoid11'</span><span class="p">,</span>
            <span class="s">'name'</span><span class="p">,</span>
            <span class="s">'median_hhi'</span>
        <span class="p">],</span>
        <span class="n">data_fields</span><span class="o">=</span><span class="p">[</span><span class="s">'geoid11'</span><span class="p">,</span> <span class="s">'geometry'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">],</span>
        <span class="n">table</span><span class="o">=</span><span class="s">'geocookbook_tract_na_shapes_full'</span><span class="p">,</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">(),</span>
        <span class="n">data_filters</span><span class="o">=</span><span class="p">(),</span>
        <span class="n">aggregations</span><span class="o">=</span><span class="p">(),</span>
        <span class="n">join</span><span class="o">=</span><span class="n">APIMedianQueryParams</span><span class="p">(</span>
            <span class="n">on</span><span class="o">=</span><span class="p">{</span><span class="s">'left'</span><span class="p">:</span> <span class="p">[</span><span class="s">'geoid11'</span><span class="p">],</span> <span class="s">'right'</span><span class="p">:</span> <span class="p">[</span><span class="s">'geoid'</span><span class="p">]},</span>
            <span class="n">table</span><span class="o">=</span><span class="s">'incomeforecast_tract_annual_income_group'</span><span class="p">,</span>
            <span class="n">median_variable_name</span><span class="o">=</span><span class="s">'income_g'</span><span class="p">,</span>
            <span class="n">data_fields</span><span class="o">=</span><span class="p">[{</span><span class="s">'geoid11'</span><span class="p">:</span> <span class="s">'geoid'</span><span class="p">},</span> <span class="p">{</span><span class="s">'median_value'</span><span class="p">:</span> <span class="s">'median_hhi'</span><span class="p">}],</span>
            <span class="n">data_filters</span><span class="o">=</span><span class="p">[</span>
                <span class="n">EqualToFilter</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="mi">2019</span><span class="p">),</span>
                <span class="n">DrivetimeFilter</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mf">42.1</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=-</span><span class="mf">120.1</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">detailed_type</span><span class="o">=</span><span class="s">'drivetime_unweighted'</span><span class="p">),</span>
            <span class="p">],</span>
            <span class="n">groupby</span><span class="o">=</span><span class="p">[</span><span class="s">'geoid11'</span><span class="p">],</span>
            <span class="n">aggregations</span><span class="o">=</span><span class="p">(),</span>
        <span class="p">)</span>
    <span class="p">))</span>
</code></pre><pre class="highlight r tab-r"><code></code></pre><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>curl -X POST <span class="s2">"https://api.stratodem.com/api"</span> <span class="se">\</span>
    -H <span class="s2">"accept: application/json"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -d <span class="s2">"{</span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">GEOJSON</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">geoid11</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">geometry</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2">], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">geocookbook_tract_na_shapes_full</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">join</span><span class="se">\"</span><span class="s2">: {</span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">MEDIAN</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [{</span><span class="se">\"</span><span class="s2">geoid11</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">geoid</span><span class="se">\"</span><span class="s2">}, {</span><span class="se">\"</span><span class="s2">median_value</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">median_hhi</span><span class="se">\"</span><span class="s2">}], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">incomeforecast_tract_annual_income_group</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">geoid11</span><span class="se">\"</span><span class="s2">], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [{</span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 2019, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">}, {</span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">drivetime_unweighted</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: {</span><span class="se">\"</span><span class="s2">latitude</span><span class="se">\"</span><span class="s2">: 42.1, </span><span class="se">\"</span><span class="s2">longitude</span><span class="se">\"</span><span class="s2">: -120.1, </span><span class="se">\"</span><span class="s2">minutes</span><span class="se">\"</span><span class="s2">: 15, </span><span class="se">\"</span><span class="s2">traffic</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">disabled</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">start_time</span><span class="se">\"</span><span class="s2">: null}, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"\"</span><span class="s2">}], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">on</span><span class="se">\"</span><span class="s2">: {</span><span class="se">\"</span><span class="s2">left</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">geoid11</span><span class="se">\"</span><span class="s2">], </span><span class="se">\"</span><span class="s2">right</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">geoid</span><span class="se">\"</span><span class="s2">]}, </span><span class="se">\"</span><span class="s2">median_variable_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">income_g</span><span class="se">\"</span><span class="s2">}, </span><span class="se">\"</span><span class="s2">properties</span><span class="se">\"</span><span class="s2">: [</span><span class="se">\"</span><span class="s2">geoid11</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">median_hhi</span><span class="se">\"</span><span class="s2">]}"</span>
</code></pre><pre class="highlight vb tab-vb"><code></code></pre>
<p>To return a GeoJSON <code>FeatureCollection</code>, use the <code>APIGeoJSONQueryParams</code>. This query structure adds the 
<code>properties</code> argument, which specifies which fields will show up in each <code>Feature</code>&#39;s <code>properties</code> field in the GeoJSON response.</p>

<p>The example to the right returns the GeoJSON <code>FeatureCollection</code> for the one census tract within a 15-minute drive of 42.1,-120.1 (lat, lng).</p>

<p><code>{&quot;type&quot;: &quot;FeatureCollection&quot;, &quot;features&quot;: [{&quot;type&quot;: &quot;Feature&quot;, &quot;geometry&quot;: {&quot;type&quot;: &quot;Polygon&quot;, &quot;coordinates&quot;: [&quot;DUMMY DATA HERE&quot;]}, &quot;properties&quot;: {&quot;geoid11&quot;: 41037960100, &quot;name&quot;: &quot;Census Tract: 41037960100&quot;, &quot;median_hhi&quot;: 42182}}]}</code></p>
<h1 id='filters'>Filters</h1><h2 id='equaltofilter'><code>EqualToFilter</code></h2>
<blockquote>
<p>Use this filter to restrict data to the year 2019</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">EqualToFilter</span>

<span class="n">EqualToFilter</span><span class="p">(</span>
    <span class="n">var</span><span class="o">=</span><span class="s">'year'</span><span class="p">,</span>
    <span class="n">val</span><span class="o">=</span><span class="mi">2019</span><span class="p">)</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">eq_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2019</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"eq"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">"year"</span>, <span class="s2">"filter_value"</span>: 2019<span class="o">}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">equalToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="err"></span><span class="n">year</span><span class="err"></span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">2019</span><span class="p">)</span>
</code></pre>
<p>The <code>EqualToFilter</code> constructs a filter equivalent to <code>var = val</code> comparisons.</p>
<h2 id='betweenfilter'><code>BetweenFilter</code></h2>
<blockquote>
<p>Use this filter to restrict data where the age grouping is between 25 and 39 years old (inclusive)</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">BetweenFilter</span>

<span class="n">BetweenFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'age_g'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">between_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'age_g'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">6</span><span class="p">,</span><span class="w"> </span><span class="m">8</span><span class="p">))</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"between"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">"age_g"</span>, <span class="s2">"filter_value"</span>: <span class="o">[</span>6, 8]<span class="o">}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">betweenFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"age_g"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
</code></pre>
<p>The <code>BetweenFilter</code> constructs a filter equivalent to <code>var &gt;= val AND var &lt;= val</code> comparisons.</p>
<h2 id='infilter'><code>InFilter</code></h2>
<blockquote>
<p>Use this filter to restrict data where the year is one of the allowed values</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">InFilter</span>

<span class="n">InFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'year'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="p">[</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="mi">2024</span><span class="p">])</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">in_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2014</span><span class="p">,</span><span class="w"> </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="m">2024</span><span class="p">))</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"in"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">"year"</span>, <span class="s2">"filter_value"</span>: <span class="o">[</span>2014, 2019, 2024]<span class="o">}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">inFilter</span><span class="p">(</span><span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="s">"year"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="mi">2024</span><span class="p">))</span>
</code></pre>
<p>The <code>InFilter</code> constructs a filter equivalent to <code>var IN (val1, val2, val3)</code> comparisons.</p>
<h2 id='greaterthanfilter'><code>GreaterThanFilter</code></h2>
<blockquote>
<p>Use this filter to restrict data where the educational attainment level is greater than high school</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">GreaterThanFilter</span>

<span class="n">GreaterThanFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'educational_attainment'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">gt_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'educational_attainment'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"gt"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">"educational_attainment"</span>, <span class="s2">"filter_value"</span>: 2<span class="o">}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">greaterThanFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"educational_attainment"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
<p>The <code>GreaterThan</code> constructs a filter equivalent to <code>var &gt; val</code> comparisons.</p>
<h2 id='greaterthanorequaltofilter'><code>GreaterThanOrEqualToFilter</code></h2>
<blockquote>
<p>Use this filter to restrict data where the educational attainment level is greater than or equal to high school</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">GreaterThanOrEqualToFilter</span>

<span class="n">GreaterThanOrEqualToFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'educational_attainment'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">gte_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'educational_attainment'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"gte"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">"educational_attainment"</span>, <span class="s2">"filter_value"</span>: 2<span class="o">}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">greaterThanOrEqualToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"educational_attainment"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
<p>The <code>GreaterThanOrEqualTo</code> constructs a filter equivalent to <code>var &gt;= val</code> comparisons.</p>
<h2 id='lessthanfilter'><code>LessThanFilter</code></h2>
<blockquote>
<p>Use this filter to restrict data where the educational attainment level is less than high school</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">LessThanFilter</span>

<span class="n">LessThanFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'educational_attainment'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">lt_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'educational_attainment'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"lt"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">"educational_attainment"</span>, <span class="s2">"filter_value"</span>: 2<span class="o">}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">lessThanFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"educational_attainment"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
<p>The <code>LessThan</code> constructs a filter equivalent to <code>var &gt; val</code> comparisons.</p>
<h2 id='lessthanorequaltofilter'><code>LessThanOrEqualToFilter</code></h2>
<blockquote>
<p>Use this filter to restrict data where the educational attainment level is less than or equal to high school</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">LessThanOrEqualToFilter</span>

<span class="n">LessThanOrEqualToFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'educational_attainment'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">lte_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'educational_attainment'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"lte"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">"educational_attainment"</span>, <span class="s2">"filter_value"</span>: 2<span class="o">}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">lessThanOrEqualToFilter</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="s">"educational_attainment"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</code></pre>
<p>The <code>LessThanOrEqualTo</code> constructs a filter equivalent to <code>var &gt;= val</code> comparisons.</p>
<h2 id='notequaltofilter'><code>NotEqualToFilter</code></h2>
<blockquote>
<p>Use this filter to restrict data to all years except 2019</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">NotEqualToFilter</span>

<span class="n">NotEqualToFilter</span><span class="p">(</span>
    <span class="n">var</span><span class="o">=</span><span class="s">'year'</span><span class="p">,</span>
    <span class="n">val</span><span class="o">=</span><span class="mi">2019</span><span class="p">)</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">ne_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2019</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"ne"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">"year"</span>, <span class="s2">"filter_value"</span>: 2019<span class="o">}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">notEqualTo</span><span class="p">(</span><span class="n">filterVariable</span><span class="p">:</span><span class="o">=</span><span class="err"></span><span class="n">year</span><span class="err"></span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="mi">2019</span><span class="p">)</span>
</code></pre>
<p>The <code>NotEqualToFilter</code> constructs a filter equivalent to <code>var &lt;&gt; val</code> comparisons.</p>
<h2 id='notinfilter'><code>NotInFilter</code></h2>
<blockquote>
<p>Use this filter to restrict data where the year is not any of the specified values</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">NotInFilter</span>

<span class="n">NotInFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'year'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="p">[</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="mi">2024</span><span class="p">])</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">nin_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2014</span><span class="p">,</span><span class="w"> </span><span class="m">2019</span><span class="p">,</span><span class="w"> </span><span class="m">2024</span><span class="p">))</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"nin"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">"year"</span>, <span class="s2">"filter_value"</span>: <span class="o">[</span>2014, 2019, 2024]<span class="o">}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">notInFilter</span><span class="p">(</span><span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="s">"year"</span><span class="p">,</span> <span class="n">filterValue</span><span class="p">:</span><span class="o">=</span><span class="n">Array</span><span class="p">(</span><span class="mi">2014</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="mi">2024</span><span class="p">))</span>
</code></pre>
<p>The <code>NotInFilter</code> constructs a filter equivalent to <code>var NOT IN (val1, val2, val3)</code> comparisons.</p>
<h2 id='mileradiusfilter'><code>MileRadiusFilter</code></h2>
<blockquote>
<p>Use this filter to restrict results to geographies within a mile radius</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">MileRadiusFilter</span>

<span class="n">MileRadiusFilter</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mf">40.7589</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=-</span><span class="mf">73.9937</span><span class="p">,</span> <span class="n">miles</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c"># This gets all geographies intersecting with the mile radius </span>
<span class="c"># (any amount of intersection), and does not apply weights</span>
<span class="n">MileRadiusFilter</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mf">40.7590</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=-</span><span class="mf">73.9937</span><span class="p">,</span> <span class="n">miles</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">detailed_type</span><span class="o">=</span><span class="s">'mile_radius_unweighted'</span><span class="p">)</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">mile_radius_filter</span><span class="p">(</span><span class="n">latitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40.7589</span><span class="p">,</span><span class="w"> </span><span class="n">longitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-73.9937</span><span class="p">,</span><span class="w"> </span><span class="n">miles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"mile_radius"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">""</span>, <span class="s2">"filter_value"</span>: <span class="o">{</span><span class="s2">"latitude"</span>: 40.7590, <span class="s2">"longitude"</span>: -73.9936, <span class="s2">"miles"</span>: 5<span class="o">}}</span>
<span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"mile_radius_simple"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">""</span>, <span class="s2">"filter_value"</span>: <span class="o">{</span><span class="s2">"latitude"</span>: 40.7590, <span class="s2">"longitude"</span>: -73.9936, <span class="s2">"miles"</span>: 5<span class="o">}}</span>
<span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"mile_radius_unweighted"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">""</span>, <span class="s2">"filter_value"</span>: <span class="o">{</span><span class="s2">"latitude"</span>: 40.7590, <span class="s2">"longitude"</span>: -73.9936, <span class="s2">"miles"</span>: 5<span class="o">}}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">mileRadiusFilter</span><span class="p">(</span><span class="n">latitude</span><span class="p">:</span><span class="o">=</span><span class="mf">40.7589</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span><span class="o">=-</span><span class="mf">73.9937</span><span class="p">,</span> <span class="n">miles</span><span class="p">:</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
<p>The <code>MileRadiusFilter</code> constructs a filter to restrict results to geographies intersecting/contained by the mile radius buffer</p>
<h3 id='advanced-options'>Advanced options</h3>
<p>An advanced option for the <code>MileRadiusFilter</code> is the <code>detailed_type</code> argument, which allows one of three options:</p>

<ul>
<li><code>mile_radius</code> (default): Apply weights to the results based on the population-weighted intersection of the mile radius buffer and geographies</li>
<li><code>mile_radius_simple</code>: Apply weights to the results based on the population-weighted intersection of the mile radius buffer and simplified geographies</li>
<li><code>mile_radius_unweighted</code>: Do not apply weights. Only return all geographies intersecting with the mile radius buffer</li>
</ul>
<h2 id='drivetimefilter'><code>DrivetimeFilter</code></h2>
<blockquote>
<p>Use this filter to restrict results to geographies within an estimated drive time</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">DrivetimeFilter</span>

<span class="n">DrivetimeFilter</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mf">40.7589</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=-</span><span class="mf">73.9937</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>
<span class="c"># Compute 15-minute drive with traffic</span>
<span class="n">DrivetimeFilter</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mf">40.7589</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=-</span><span class="mf">73.9937</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">with_traffic</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">start_time</span><span class="o">=</span><span class="s">'2019-05-25T18:00:00'</span><span class="p">)</span>
<span class="c"># This gets all geographies intersecting with the drive time buffer</span>
<span class="c"># (any amount of intersection) and does not apply weights</span>
<span class="n">DrivetimeFilter</span><span class="p">(</span><span class="n">latitude</span><span class="o">=</span><span class="mf">40.7589</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=-</span><span class="mf">73.9937</span><span class="p">,</span> <span class="n">minutes</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">detailed_type</span><span class="o">=</span><span class="s">'drivetime_unweighted'</span><span class="p">)</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">drivetime_filter</span><span class="p">(</span><span class="n">latitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40.7589</span><span class="p">,</span><span class="w"> </span><span class="n">longitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-73.9937</span><span class="p">,</span><span class="w"> </span><span class="n">minutes</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">15</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"drivetime"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">""</span>, <span class="s2">"filter_value"</span>: <span class="o">{</span><span class="s2">"latitude"</span>: 40.7590, <span class="s2">"longitude"</span>: -73.9936, <span class="s2">"minutes"</span>: 15<span class="o">}}</span>
<span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"drivetime_simple"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">""</span>, <span class="s2">"filter_value"</span>: <span class="o">{</span><span class="s2">"latitude"</span>: 40.7590, <span class="s2">"longitude"</span>: -73.9936, <span class="s2">"minutes"</span>: 15<span class="o">}}</span>
<span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"drivetime_unweighted"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">""</span>, <span class="s2">"filter_value"</span>: <span class="o">{</span><span class="s2">"latitude"</span>: 40.7590, <span class="s2">"longitude"</span>: -73.9936, <span class="s2">"minutes"</span>: 15<span class="o">}}</span>
<span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"drivetime"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">""</span>, <span class="s2">"filter_value"</span>: <span class="o">{</span><span class="s2">"latitude"</span>: 40.7590, <span class="s2">"longitude"</span>: -73.9936, <span class="s2">"minutes"</span>: 15, <span class="s2">"with_traffic"</span>: <span class="nb">true</span>, <span class="s2">"start_time"</span>: <span class="s2">"2019-05-25T18:00:00"</span><span class="o">}}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">drivetimeFilter</span><span class="p">(</span><span class="n">latitude</span><span class="p">:</span><span class="o">=</span><span class="mf">40.7589</span><span class="p">,</span> <span class="n">longitude</span><span class="p">:</span><span class="o">=-</span><span class="mf">73.9937</span><span class="p">,</span> <span class="n">minutes</span><span class="p">:</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</code></pre>
<p>The <code>DrivetimeFilter</code> constructs a filter to restrict results to geographies intersecting/contained by the drive time buffer</p>
<h3 id='advanced-options-2'>Advanced options</h3>
<p>An advanced option for the <code>DrivetimeFilter</code> is the <code>detailed_type</code> argument, which allows one of three options:</p>

<ul>
<li><code>drivetime</code> (default): Apply weights to the results based on the population-weighted intersection of the drive time buffer and geographies</li>
<li><code>drivetime_simple</code>: Apply weights to the results based on the population-weighted intersection of the drive time buffer and simplified geographies</li>
<li><code>drivetime_unweighted</code>: Do not apply weights. Only return all geographies intersecting with the drive time buffer</li>
</ul>

<p>To compute drive time estimates with traffic, two arguments are used: <code>with_traffic</code> and <code>start_time</code>:</p>

<ul>
<li><code>with_traffic</code> (defaults to <code>False</code>) toggles on (<code>True</code>) or off (<code>False</code>) traffic calculations</li>
<li><code>start_time</code> (defaults to <code>None</code>) adjusts the departure time used to compute the traffic buffer</li>
</ul>
<h2 id='intersectsfilter'><code>IntersectsFilter</code></h2>
<blockquote>
<p>Use this filter to restrict results to geographies intersecting a GeoJSON Polygon</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.filters</span> <span class="kn">import</span> <span class="n">IntersectsFilter</span>

<span class="n">IntersectsFilter</span><span class="p">(</span>
    <span class="n">var</span><span class="o">=</span><span class="s">'geometry'</span><span class="p">,</span> 
    <span class="n">val</span><span class="o">=</span><span class="p">{</span>
      <span class="s">"type"</span><span class="p">:</span> <span class="s">"Feature"</span><span class="p">,</span>
      <span class="s">"properties"</span><span class="p">:</span> <span class="p">{},</span>
      <span class="s">"geometry"</span><span class="p">:</span> <span class="p">{</span>
        <span class="s">"type"</span><span class="p">:</span> <span class="s">"Polygon"</span><span class="p">,</span>
        <span class="s">"coordinates"</span><span class="p">:</span> <span class="p">[[</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">71.13269805908203</span><span class="p">,</span> <span class="mf">42.298135272741206</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">70.99433898925781</span><span class="p">,</span> <span class="mf">42.298135272741206</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">70.99433898925781</span><span class="p">,</span> <span class="mf">42.385937107381125</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">71.13269805908203</span><span class="p">,</span> <span class="mf">42.385937107381125</span><span class="p">],</span>
            <span class="p">[</span><span class="o">-</span><span class="mf">71.13269805908203</span><span class="p">,</span> <span class="mf">42.298135272741206</span><span class="p">]</span>
          <span class="p">]]</span>
      <span class="p">}</span>
    <span class="p">})</span>
</code></pre><pre class="highlight r tab-r"><code><span class="c1"># Not implemented yet!
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"filter_type"</span>: <span class="s2">"intersects"</span>, <span class="s2">"filter_variable"</span>: <span class="s2">"geometry"</span>, <span class="s2">"filter_value"</span>: <span class="o">{</span><span class="s2">"type"</span>: <span class="s2">"Feature"</span>, <span class="s2">"properties"</span>: <span class="o">{}</span>, <span class="s2">"geometry"</span>: <span class="o">{</span><span class="s2">"type"</span>: <span class="s2">"Polygon"</span>, <span class="s2">"coordinates"</span>: <span class="o">[[[</span>-71.13269805908203, 42.298135272741206], <span class="o">[</span>-70.99433898925781, 42.298135272741206], <span class="o">[</span>-70.99433898925781, 42.385937107381125], <span class="o">[</span>-71.13269805908203, 42.385937107381125], <span class="o">[</span>-71.13269805908203, 42.298135272741206]]]<span class="o">}}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="c1">' Not implemented yet!</span>
</code></pre>
<p>The <code>IntersectsFilter</code> constructs a filter to restrict results to geographies intersecting the GeoJSON polygon</p>
<h1 id='aggregations'>Aggregations</h1>
<p>In many cases, we want to aggregate data returned by the API. For example, if we have the SQL query:
<code>SELECT year, geoid5, sum(households) FROM incomeforecast_county_annual_income_group_age WHERE income_g &gt;= 5 AND age_g &gt;= 17 GROUP BY year, geoid5 ORDER BY year, geoid5;</code>, 
we need to group by the <code>year</code> and <code>geoid5</code> (county) columns, and then get the sum of <code>households</code> for each combination.</p>

<p>Aggregrations tell the API which columns to aggregate, using which function.</p>
<h2 id='sumaggregation'><code>SumAggregation</code></h2>
<blockquote>
<p>This tells the API to take the sum of population</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query.aggregations</span> <span class="kn">import</span> <span class="n">SumAggregation</span>

<span class="n">SumAggregation</span><span class="p">(</span><span class="s">'population'</span><span class="p">)</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">sum_aggregation</span><span class="p">(</span><span class="n">variable_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'population'</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="o">{</span><span class="s2">"aggregation_type"</span>: <span class="s2">"sum"</span>, <span class="s2">"variable_name"</span>: <span class="s2">"population"</span><span class="o">}</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="n">sumAggregation</span><span class="p">(</span><span class="n">variableName</span><span class="p">:</span><span class="o">=</span><span class="s">"population"</span><span class="p">)</span>
</code></pre>
<p>Sum aggregations tell the API to return the sum of the variable passed in, equivalent to <code>sum(variable_name)</code> in SQL</p>
<h1 id='sample-queries'>Sample queries</h1><h2 id='population-density-in-the-boston-ma-msa'>Population density in the Boston, MA MSA</h2>
<blockquote>
<p>Population density in Boston up to 2015:</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query</span> <span class="kn">import</span> <span class="n">SDAPIQuery</span><span class="p">,</span> <span class="n">APIQueryParams</span><span class="p">,</span> <span class="n">EqualToFilter</span><span class="p">,</span> <span class="n">LessThanFilter</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">SDAPIQuery</span><span class="o">.</span><span class="n">query_api_df</span><span class="p">(</span>
    <span class="n">query_params</span><span class="o">=</span><span class="n">APIQueryParams</span><span class="p">(</span>
        <span class="n">query_type</span><span class="o">=</span><span class="s">'COUNT'</span><span class="p">,</span>
        <span class="n">table</span><span class="o">=</span><span class="s">'populationforecast_metro_annual_population'</span><span class="p">,</span>
        <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'cbsa'</span><span class="p">,</span> <span class="p">{</span><span class="s">'population'</span><span class="p">:</span> <span class="s">'population'</span><span class="p">}),</span>
        <span class="n">data_filters</span><span class="o">=</span><span class="p">(</span>
            <span class="n">LessThanFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'year'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">2015</span><span class="p">),</span>
            <span class="n">EqualToFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'cbsa'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">14454</span><span class="p">),</span>
        <span class="p">),</span>
        <span class="n">aggregations</span><span class="o">=</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">aggregation_func</span><span class="o">=</span><span class="s">'sum'</span><span class="p">,</span> <span class="n">variable_name</span><span class="o">=</span><span class="s">'population'</span><span class="p">),),</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">(</span><span class="s">'cbsa'</span><span class="p">,</span> <span class="s">'year'</span><span class="p">),</span>
        <span class="n">order</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,),</span>
        <span class="n">join</span><span class="o">=</span><span class="n">APIQueryParams</span><span class="p">(</span>
            <span class="n">query_type</span><span class="o">=</span><span class="s">'AREA'</span><span class="p">,</span>
            <span class="n">table</span><span class="o">=</span><span class="s">'geocookbook_metro_na_shapes_full'</span><span class="p">,</span>
            <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s">'cbsa'</span><span class="p">,</span> <span class="s">'area'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">),</span>
            <span class="n">data_filters</span><span class="o">=</span><span class="p">(</span><span class="n">EqualToFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'cbsa'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="mi">14454</span><span class="p">),),</span>
            <span class="n">groupby</span><span class="o">=</span><span class="p">(</span><span class="s">'cbsa'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">),</span>
            <span class="n">aggregations</span><span class="o">=</span><span class="p">(),</span>
            <span class="n">on</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="p">(</span><span class="s">'cbsa'</span><span class="p">,),</span> <span class="n">right</span><span class="o">=</span><span class="p">(</span><span class="s">'cbsa'</span><span class="p">,)),</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">apiToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'my-api-token'</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">submit_api_query</span><span class="p">(</span><span class="w">
  </span><span class="n">query</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_query_params</span><span class="p">(</span><span class="w">
    </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'populationforecast_metro_annual_population'</span><span class="p">,</span><span class="w">
    </span><span class="n">data_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_fields</span><span class="p">(</span><span class="n">fields_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="s1">'cbsa'</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">population</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'population'</span><span class="p">))),</span><span class="w">
    </span><span class="n">data_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
        </span><span class="n">lt_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">2015</span><span class="p">),</span><span class="w">
        </span><span class="n">eq_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'cbsa'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">14454</span><span class="p">)</span><span class="w">
    </span><span class="p">),</span><span class="w">
    </span><span class="n">groupby</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="s1">'cbsa'</span><span class="p">),</span><span class="w">
    </span><span class="n">aggregations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">sum_aggregation</span><span class="p">(</span><span class="n">variable_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'population'</span><span class="p">)),</span><span class="w">
    </span><span class="n">join</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_query_params</span><span class="p">(</span><span class="w">
        </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'geocookbook_metro_na_shapes_full'</span><span class="p">,</span><span class="w">
        </span><span class="n">query_type</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'AREA'</span><span class="p">,</span><span class="w">
        </span><span class="n">data_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_fields</span><span class="p">(</span><span class="n">fields_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'cbsa'</span><span class="p">,</span><span class="w"> </span><span class="s1">'area'</span><span class="p">,</span><span class="w"> </span><span class="s1">'name'</span><span class="p">)),</span><span class="w">
        </span><span class="n">data_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(),</span><span class="w">
        </span><span class="n">groupby</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'cbsa'</span><span class="p">,</span><span class="w"> </span><span class="s1">'name'</span><span class="p">),</span><span class="w">
        </span><span class="n">aggregations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(),</span><span class="w">
        </span><span class="n">on</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">left</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'cbsa'</span><span class="p">),</span><span class="w"> </span><span class="n">right</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'cbsa'</span><span class="p">))</span><span class="w">
    </span><span class="p">)</span><span class="w">
  </span><span class="p">),</span><span class="w">
  </span><span class="n">apiToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apiToken</span><span class="p">)</span><span class="w">

</span><span class="n">df</span><span class="o">$</span><span class="n">pop_per_sq_mi</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">population</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="n">df</span><span class="o">$</span><span class="n">area</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>curl -X POST <span class="s2">"https://api.stratodem.com/api"</span> <span class="se">\</span>
    -H <span class="s2">"accept: application/json"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -d <span class="s2">"{ </span><span class="se">\"</span><span class="s2">token</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">my-api-token</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">query</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">COUNT</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, { </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">populationforecast_metro_annual_population</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">lt</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 2015, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> }, { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 14454, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">aggregation_func</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">sum</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">variable_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">join</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">AREA</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">area</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">geocookbook_metro_na_shapes_full</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 14454, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">on</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">left</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">right</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2"> ] } }, </span><span class="se">\"</span><span class="s2">order</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> ]}}"</span>
</code></pre>
<p>Calculating the population density (population per square mile) in the Boston, MA MSA, by year.</p>

<table><thead>
<tr>
<th>YEAR</th>
<th>NAME</th>
<th>POP_PER_SQ_MI</th>
</tr>
</thead><tbody>
<tr>
<td>2014</td>
<td>Boston, MA</td>
<td>1665.827530</td>
</tr>
<tr>
<td>2013</td>
<td>Boston, MA</td>
<td>1651.187549</td>
</tr>
<tr>
<td>2012</td>
<td>Boston, MA</td>
<td>1633.847778</td>
</tr>
<tr>
<td>2011</td>
<td>Boston, MA</td>
<td>1617.340007</td>
</tr>
<tr>
<td>2010</td>
<td>Boston, MA</td>
<td>1601.802067</td>
</tr>
</tbody></table>
<h2 id='population-within-five-miles-of-latitude-longitude-pair'>Population within five miles of latitude-longitude pair</h2>
<blockquote>
<p>Population within five miles of 40.7589542, -73.9937348&#39;):</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query</span> <span class="kn">import</span> <span class="n">SDAPIQuery</span><span class="p">,</span> <span class="n">APIQueryParams</span><span class="p">,</span> <span class="n">MileRadiusFilter</span><span class="p">,</span> <span class="n">BetweenFilter</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">SDAPIQuery</span><span class="o">.</span><span class="n">query_api_df</span><span class="p">(</span>
    <span class="n">query_params</span><span class="o">=</span><span class="n">APIQueryParams</span><span class="p">(</span>
        <span class="n">table</span><span class="o">=</span><span class="s">'populationforecast_tract_annual_population'</span><span class="p">,</span>
        <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s">'YEAR'</span><span class="p">,</span> <span class="p">{</span><span class="s">'population'</span><span class="p">:</span> <span class="s">'population_within_5_miles'</span><span class="p">}),</span>
        <span class="n">data_filters</span><span class="o">=</span><span class="p">(</span>
            <span class="c"># Aggregate data within five miles of 40.7589542, -73.9937348</span>
            <span class="n">MileRadiusFilter</span><span class="p">(</span>
                <span class="n">latitude</span><span class="o">=</span><span class="mf">40.75895</span><span class="p">,</span> <span class="n">longitude</span><span class="o">=-</span><span class="mf">73.9937</span><span class="p">,</span> <span class="n">miles</span><span class="o">=</span><span class="mi">5</span><span class="p">),</span>
            <span class="c"># Only get data for years between 2010 and 2020 (inclusive)</span>
            <span class="n">BetweenFilter</span><span class="p">(</span><span class="n">var</span><span class="o">=</span><span class="s">'year'</span><span class="p">,</span> <span class="n">val</span><span class="o">=</span><span class="p">[</span><span class="mi">2010</span><span class="p">,</span> <span class="mi">2020</span><span class="p">])),</span>
        <span class="n">aggregations</span><span class="o">=</span><span class="p">({</span><span class="s">'variable_name'</span><span class="p">:</span> <span class="s">'population'</span><span class="p">,</span> <span class="s">'aggregation_func'</span><span class="p">:</span> <span class="s">'sum'</span><span class="p">},),</span>
        <span class="n">groupby</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,)))</span>
</code></pre><pre class="highlight r tab-r"><code><span class="n">library</span><span class="p">(</span><span class="n">stRatoquery</span><span class="p">)</span><span class="w">

</span><span class="n">apiToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'my-api-token'</span><span class="w">

</span><span class="n">df</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">submit_api_query</span><span class="p">(</span><span class="w">
  </span><span class="n">api_query_params</span><span class="p">(</span><span class="w">
    </span><span class="n">table</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'populationforecast_tract_annual_population'</span><span class="p">,</span><span class="w">
    </span><span class="n">data_fields</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">api_fields</span><span class="p">(</span><span class="n">fields_list</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="s1">'YEAR'</span><span class="p">,</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">population</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'population_within_5_miles'</span><span class="p">))),</span><span class="w">
    </span><span class="n">data_filters</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="w">
      </span><span class="c1"># Aggregate data within five miles of 40.7589, -73.9937
</span><span class="w">      </span><span class="n">mile_radius_filter</span><span class="p">(</span><span class="n">latitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">40.7589</span><span class="p">,</span><span class="w"> </span><span class="n">longitude</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">-73.9937</span><span class="p">,</span><span class="w"> </span><span class="n">miles</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="m">5</span><span class="p">),</span><span class="w">
      </span><span class="c1"># Only get data for years between 2010 and 2020 (inclusive)
</span><span class="w">      </span><span class="n">between_filter</span><span class="p">(</span><span class="n">filter_variable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'year'</span><span class="p">,</span><span class="w"> </span><span class="n">filter_value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="m">2010</span><span class="p">,</span><span class="w"> </span><span class="m">2020</span><span class="p">))),</span><span class="w">
    </span><span class="n">aggregations</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">list</span><span class="p">(</span><span class="n">sum_aggregation</span><span class="p">(</span><span class="n">variable_name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s1">'population'</span><span class="p">)),</span><span class="w">
    </span><span class="n">groupby</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nf">c</span><span class="p">(</span><span class="s1">'year'</span><span class="p">)),</span><span class="w">
  </span><span class="n">apiToken</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">apiToken</span><span class="p">)</span><span class="w">
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>curl -X POST <span class="s2">"https://api.stratodem.com/api"</span> <span class="se">\</span>
    -H <span class="s2">"accept: application/json"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -d <span class="s2">"{ </span><span class="se">\"</span><span class="s2">token</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">my-api-token</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">query</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">COUNT</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">YEAR</span><span class="se">\"</span><span class="s2">, { </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">population_within_5_miles</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">populationforecast_tract_annual_population</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">mile_radius</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">latitude</span><span class="se">\"</span><span class="s2">: 40.75895, </span><span class="se">\"</span><span class="s2">longitude</span><span class="se">\"</span><span class="s2">: -73.9937, </span><span class="se">\"</span><span class="s2">miles</span><span class="se">\"</span><span class="s2">: 5 }, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"\"</span><span class="s2"> }, { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">between</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: [ 2010, 2020 ], </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">variable_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">aggregation_func</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">sum</span><span class="se">\"</span><span class="s2"> } ]}}"</span>
</code></pre>
<p>Calculating the population within a mile radius buffer, by year.</p>

<table><thead>
<tr>
<th>YEAR</th>
<th>POPULATION_WITHIN_5_MILES</th>
</tr>
</thead><tbody>
<tr>
<td>2010</td>
<td>2.333544e+06</td>
</tr>
<tr>
<td>2011</td>
<td>2.369469e+06</td>
</tr>
<tr>
<td>2012</td>
<td>2.400245e+06</td>
</tr>
<tr>
<td>2013</td>
<td>2.420539e+06</td>
</tr>
<tr>
<td>2014</td>
<td>2.438206e+06</td>
</tr>
</tbody></table>
<h1 id='submitting-multiple-queries'>Submitting multiple queries</h1>
<blockquote>
<p>Submit multiple queries with unique IDs to the API for a batch query</p>
</blockquote>
<pre class="highlight python tab-python"><code><span class="kn">from</span> <span class="nn">strato_query</span> <span class="kn">import</span> <span class="n">SDAPIQuery</span><span class="p">,</span> <span class="n">APIQueryParams</span>

<span class="c"># This returns a dictionary with the query ID pointing to a pandas.DataFrame</span>
<span class="n">SDAPIQuery</span><span class="o">.</span><span class="n">query_api_multiple</span><span class="p">(</span>
    <span class="n">queries</span><span class="o">=</span><span class="p">{</span>
        <span class="s">'query1'</span><span class="p">:</span> <span class="n">APIQueryParams</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="s">'populationforecast_us_annual_population'</span><span class="p">,</span>
            <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'population'</span><span class="p">),</span>
            <span class="n">data_filters</span><span class="o">=</span><span class="p">(),</span>
            <span class="n">groupby</span><span class="o">=</span><span class="p">(),</span>
            <span class="n">aggregations</span><span class="o">=</span><span class="p">()),</span>
        <span class="s">'query2'</span><span class="p">:</span> <span class="n">APIQueryParams</span><span class="p">(</span>
            <span class="n">table</span><span class="o">=</span><span class="s">'populationforecast_state_annual_population_age'</span><span class="p">,</span>
            <span class="n">data_fields</span><span class="o">=</span><span class="p">(</span><span class="s">'year'</span><span class="p">,</span> <span class="s">'geoid2'</span><span class="p">,</span> <span class="s">'age_g'</span><span class="p">,</span> <span class="s">'population'</span><span class="p">),</span>
            <span class="n">data_filters</span><span class="o">=</span><span class="p">(),</span>
            <span class="n">groupby</span><span class="o">=</span><span class="p">(),</span>
            <span class="n">aggregations</span><span class="o">=</span><span class="p">()),</span>
    <span class="p">})</span>
</code></pre><pre class="highlight r tab-r"><code><span class="c1"># Not officially supported
</span></code></pre><pre class="highlight shell tab-shell"><code><span class="gp">$ </span>curl -X POST <span class="s2">"https://api.stratodem.com/api"</span> <span class="se">\</span>
    -H <span class="s2">"accept: application/json"</span> <span class="se">\</span>
    -H <span class="s2">"Content-Type: application/json"</span> <span class="se">\</span>
    -d <span class="s2">"{ </span><span class="se">\"</span><span class="s2">token</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">my-api-token</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">queries</span><span class="se">\"</span><span class="s2">: {</span><span class="se">\"</span><span class="s2">query1</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">COUNT</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, { </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">populationforecast_metro_annual_population</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">lt</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 2015, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> }, { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 14454, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">aggregation_func</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">sum</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">variable_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">join</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">AREA</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">area</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">geocookbook_metro_na_shapes_full</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 14454, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">on</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">left</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">right</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2"> ] } }, </span><span class="se">\"</span><span class="s2">order</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> ]}}, </span><span class="se">\"</span><span class="s2">query2</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">COUNT</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, { </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">populationforecast_metro_annual_population</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">lt</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 2015, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> }, { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 14454, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">aggregation_func</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">sum</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">variable_name</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">population</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">join</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">query_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">AREA</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">data_fields</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">area</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">table</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">geocookbook_metro_na_shapes_full</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">groupby</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">name</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">data_filters</span><span class="se">\"</span><span class="s2">: [ { </span><span class="se">\"</span><span class="s2">filter_type</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">eq</span><span class="se">\"</span><span class="s2">, </span><span class="se">\"</span><span class="s2">filter_value</span><span class="se">\"</span><span class="s2">: 14454, </span><span class="se">\"</span><span class="s2">filter_variable</span><span class="se">\"</span><span class="s2">: </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2"> } ], </span><span class="se">\"</span><span class="s2">aggregations</span><span class="se">\"</span><span class="s2">: [], </span><span class="se">\"</span><span class="s2">on</span><span class="se">\"</span><span class="s2">: { </span><span class="se">\"</span><span class="s2">left</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2"> ], </span><span class="se">\"</span><span class="s2">right</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">cbsa</span><span class="se">\"</span><span class="s2"> ] } }, </span><span class="se">\"</span><span class="s2">order</span><span class="se">\"</span><span class="s2">: [ </span><span class="se">\"</span><span class="s2">year</span><span class="se">\"</span><span class="s2"> ]}}}}"</span>
</code></pre><pre class="highlight vb tab-vb"><code><span class="c1">' Not officially supported</span>
</code></pre>
<p>The StratoDem Analytics API supports batches of queries to execute in parallel. The Python package supports this 
through the <code>SDAPIQuery.query_api_multiple</code> method, which takes a dictionary of queries and returns a dictionary of <code>pandas.DataFrames</code></p>

      </div>
      <div class="dark-box">
          <div class="lang-selector">
                <a href="#" data-language-name="python">python</a>
                <a href="#" data-language-name="r">r</a>
                <a href="#" data-language-name="shell">shell</a>
                <a href="#" data-language-name="vb">vb</a>
          </div>
      </div>
    </div>
  </body>
</html>
